# Poosh

A composite GitHub Action to commit, push, or open a pull request for any changes in the repository. Use this action after your workflow has made changes to files.

## Features

- Commits and pushes changes to a user-configurable branch (always prefixed with `poosh/`)
- On push events, pushes directly to the branch
- On other events, opens a pull request from the branch
- PR title is always set to the commit message
- PR branch is always deleted after merge/close (`delete-branch: true`)
- PR body can be customized via the `pr-body` input, or defaults to a standard message
- Robust input validation and clear warnings
- Outputs branch name, commit SHA, PR URL, and PR number

## Inputs

| Name                  | Description                                                                 | Required | Default |
|-----------------------|-----------------------------------------------------------------------------|----------|---------|
| `commit-message`      | Commit message to use when committing changes.                              | Yes      |         |
| `branch`              | Suffix for the branch to push/PR to. The branch will always be `poosh/{branch}`. | Yes      |         |
| `trigger-pr-number`   | PR number of the triggering PR (for PR body).                               | No       |         |
| `trigger-branch-name` | Name of the triggering branch (for PR body if no PR number).                | No       |         |
| `pr-body`             | Custom body for the pull request. If not set, a default body is used.       | No       |         |

## Outputs

| Name         | Description                                                        |
|--------------|--------------------------------------------------------------------|
| `branch`     | The full branch name used for push/PR (always prefixed with `poosh/`). |
| `commit-sha` | The commit SHA of the pushed commit (if a commit was made).        |
| `pr-url`     | The URL of the created pull request (if a PR was opened).          |
| `pr-number`  | The number of the created pull request (if a PR was opened).       |

## Usage

### Push changes (on push event)

```yaml
- uses: ./actions/poosh
  with:
    commit-message: "chore: update generated files"
    branch: "autogen"
```

### Open a pull request (on non-push event)

```yaml
- uses: ./actions/poosh
  with:
    commit-message: "chore: update"
    branch: "feature-update"
    trigger-pr-number: ${{ github.event.pull_request.number }}
    trigger-branch-name: ${{ github.head_ref || github.ref_name }}
```

### Custom PR body

```yaml
- uses: ./actions/poosh
  with:
    commit-message: "chore: update"
    branch: "feature-update"
    pr-body: |
      This PR updates build artifacts based on the latest implementation. Generated by GitHub Actions.
      Triggered by #1234
```

## Validation & Warnings

- Fails if `commit-message` or `branch` is missing or invalid.
- Warns if neither `trigger-pr-number` nor `trigger-branch-name` is set (PR body will not include a trigger reference).
- Only allows alphanumeric, `.`, `_`, `-`, and `/` in the branch suffix.

## Outputs

- `branch`: The full branch name used (e.g., `poosh/autogen`)
- `commit-sha`: The commit SHA (if a commit was made)
- `pr-url`: The pull request URL (if a PR was opened)
- `pr-number`: The pull request number (if a PR was opened)

## How It Works

1. Validates all inputs and combinations, failing early with clear errors.
2. Sets the branch name as `poosh/{branch}`.
3. If changes are detected:
   - On push events, commits and pushes to the branch.
   - On other events, opens a pull request from the branch.
   - PR title is always the commit message.
   - PR branch is always deleted after merge/close.
   - PR body is set via `pr-body` if provided, otherwise a default is used.
4. Sets outputs for branch, commit SHA, PR URL, and PR number.

## License

MIT
